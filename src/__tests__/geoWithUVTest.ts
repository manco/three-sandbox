import {Mesh} from "three";
import {BufferGeometry} from "three";
import {OBJLoader} from "three";
import '../../node_modules/three/examples/js/loaders/OBJLoader';

test('geometry loaded with uv', () => {

    const blat = `
o blat

v  -11.8110 -11.8111 32.2835
v  -11.8110 11.8110 32.2835
v  11.8111 11.8110 32.2835
v  11.8111 -11.8111 32.2835
v  -11.8110 -11.8111 33.4646
v  11.8111 -11.8111 33.4646
v  11.8111 11.8110 33.4646
v  -11.8110 11.8110 33.4646

vn 0.0000 0.0000 -1.0000
vn 0.0000 0.0000 1.0000
vn 0.0000 -1.0000 0.0000
vn 1.0000 0.0000 0.0000
vn 0.0000 1.0000 0.0000
vn -1.0000 0.0000 0.0000

g blat
f 5/4/2 6/1/2 7/2/2 8/3/2
f 1/1/1 2/2/1 3/3/1 4/4/1
f 1/4/3 4/1/3 6/2/3 5/3/3
f 4/4/4 3/1/4 7/2/4 6/3/4
f 3/4/5 2/1/5 8/2/5 7/3/5
f 2/4/6 1/1/6 5/2/6 8/3/6 
    `;

const corner = `

o corner

v  -11.8109 -15.7479 32.2835
v  11.8112 -15.7479 32.2835
v  11.8112 -15.7479 33.4646
v  -11.8109 -15.7479 33.4646
v  11.8112 11.8112 32.2835
v  11.8112 11.8112 33.4646
v  -15.7479 11.8112 32.2835
v  -15.7479 11.8112 33.4646
v  -15.7479 -11.8109 32.2835
v  -15.7479 -11.8109 33.4646
v  -11.8109 -11.8109 32.2835
v  -11.8109 -11.8109 33.4646

vn 0.0000 -1.0000 0.0000
vn 1.0000 0.0000 0.0000
vn 0.0000 1.0000 0.0000
vn -1.0000 0.0000 0.0000
vn 0.0000 0.0000 -1.0000
vn 0.0000 -0.0000 -1.0000
vn 0.0000 0.0000 1.0000

vt 1.0000 0.0000 0.0000
vt 1.0000 1.0000 0.0000
vt 0.0000 1.0000 0.0000
vt 0.0000 0.0000 0.0000

g corner
f 1//1 2//1 3//1 4//1 
f 2//2 5//2 6//2 3//2 
f 5//3 7//3 8//3 6//3 
f 7//4 9//4 10//4 8//4 
f 9//1 11//1 12//1 10//1 
f 11//4 1//4 4//4 12//4 
f 7//5 5//5 11//6 9//5 
f 2//5 1//6 11//6 5//5 
f 8//7 10//7 12//7 6//7 
f 3//7 6//7 12//7 4//7 
`;

    const input = blat;

    const mesh = new OBJLoader().parse(input).children[0] as Mesh;

    const geo = mesh.geometry as BufferGeometry;
    expect(geo.attributes.uv).toBeDefined();
});